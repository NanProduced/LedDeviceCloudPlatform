---
title: '**云平台权限模型方案**'
---

**注：文档1、2部分描述当前权限模型的问题，剩下部分为新的解决方案阐述。该方案融合了用户角色权限（RBAC）和资源所属组权限判断（类似ABAC策略），参考一些物联网场景的权限管理方案，旨在实现灵活、可控且逻辑闭环的播放盒设备及媒体资源权限管理。**

**背景与问题陈述**
==================

**在云平台当前设计中，用户通过用户组来继承和管理各种资源的权限，包括对终端设备的控制权和对节目、素材内容的访问权，近期在新增功能和用户需求评审中发现了以下关键问题：**

**用户需求**
------------

-   ### **客户想要移动用户（账号）所属组**

**用户要求添加移动用户功能，但由于系统设计中，素材和节目的权限归属于用户，所以当用户发生移动，例如被移动至更高层级的用户组，那么原先组中的用户则无法访问被移动的用户的素材和节目。**

**即当用户的用户组发生变动，对于用户拥有的素材、节目资源，原组内的其他用户是否还能看见或管理，如何处理此可见性冲突。**

-   ### **客户想要同时管理多个终端组**

**当前云平台设计中，一个用户仅属于一个用户组，且一个用户组映射一个终端组（从前端页面看来，用户和终端都属于终端组），有客户想让一个账号（用户）同时管理多个终端组（非父子组关系）以适应自己的使用场景。**

**但是考虑平台权限模型，即使新增额外的关联关系（例如添加表将额外的终端组权限赋予某个用户）也会出现权限冲突，因为用户关联终端组意味着同时拥有了该组下终端和用户的管理权限。**

**问题归纳**
------------

-   **终端和资源（素材、节目）权限的归属问题**

-   **用户组变动对资源可见性的影响**

-   **权限模型不完整及鉴权过程未形成逻辑闭环**

**关键问题**
============

### **素材权限与用户的耦合**

**根据对多种方案的探索和对其的评估，总结出造成终端/资源权限冲突的关键问题是：素材权限与用户的耦合**

![descript](media/image1.png){width="6.299305555555556in"
height="4.358240376202975in"}

***云平台资源归属关系***

-   **资源所有权与创建者绑定：素材、节目等资源在创建时，其权限（如可见性、修改权）
    直接与创建该资源的用户绑定。**

-   **资源权限可从用户组继承：同一用户组下，或对某个用户组有权限，可以获得组下所有用户的素材、节目的权限。**

**这种耦合在简单场景下看似合理，但在用户和组织结构发生变化时，就会暴露出其固有的缺陷。**

### **引发的冲突**

#### **用户移动时的权限冲突**

**这是最常见且最难处理的问题。当用户在不同用户组间移动时，如果资源权限与用户耦合，将导致以下冲突：**

-   **资源可见性丧失：**

    -   **场景：用户U2在用户组A-1中上传了素材M1。M1的权限（可见性）依赖于用户U2在A-1的身份或A-1的层级关系，所有用户U1也可以使用素材M1，当用户U2被移动到用户组A-2时，如果M1的权限仍然与用户U2绑定，那么用户A可能无法再看到或管理素材M1。**

![descript](media/image2.png){width="6.299305555555556in"
height="3.7506878827646544in"}

***移动用户造成权限冲突示意图***

-   **权限冗余与冲突：**

    -   **如果为了避免权限丢失而为用户额外创建关系保留已使用资源的权限，会导致用户权限集合不断膨胀，难以管理。同时，当多个用户（不同组）对同一资源拥有权限时，可能出现权限冲突。**

-   **权限冲突的节目被发布到终端：**

    -   **假设由于用户移动影响的素材被发布到终端，那么将引入终端组权限的冲突，又增加了复杂性。**

#### **组织结构调整的复杂性**

**当组织结构（用户组层级）发生调整时，如果资源权限与用户紧密耦合，将带来巨大的维护成本：**

-   **资源权限批量调整：**

    -   **用户组的合并、拆分、移动等操作，涉及全部或部分用户，可能需要对大量资源进行批量调整，工作量巨大且容易出错。**

-   **权限链断裂：**

    -   **如果用户被删除，其下所有资源可能面临丢失状态，需要负责的额外逻辑和机制。**

#### **共享机制的局限性**

**资源权限与用户耦合，将素材共享至用户组时，逻辑复杂，不好管理。**

#### **权限判断逻辑的复杂化**

**为了处理上述各种情况，权限判断逻辑会变得异常复杂，需要考虑：**

**• 用户当前的用户组归属。**

**• 资源所属的用户。**

**• 用户与资源所属用户的权限关系。**

**• 各种共享关系。**

**• 用户角色权限。**

**这种复杂的逻辑不仅增加了开发难度，也增加了系统维护和故障排查的难度。**

### **解决方案**

**解决该问题的核心思路是
解耦。将资源的所有权从特定用户中剥离出来，转而与更稳定、更具组织性的实体（用户组）进行关联。考察竞品发现诺瓦屏精灵也将资源权限与组挂钩，不与用户直接产生关联。**

**以下为实现方案**

3.  **核心概念和关系定义**
    ======================

    1.  **核心实体**
        ------------

-   ### **组织（Organization）：**

-   **类似Saas平台中的租户概念，系统中的最高隔离单位，代表一个独立的租户。每个组织拥有独立的数据空间和用户体系。**

-   **每个组织内设有一个 组织管理员
    角色，该角色拥有组织范围内的所有权限，理论上隶属于组织而不是某个用户组（实际操作中可归属于一个特殊的组织根用户组）。**

-   ### **用户组（User Group）：**

```{=html}
<!-- -->
```
-   **树形结构：用于组织和管理用户，可多级嵌套，形成清晰的层级关系。**

-   **管理边界与可视性:
    用户组的层级关系定义了其下用户的管理边界和可视性。上级用户组的用户可以查看并管理其下级用户组的用户（具体操作权限视用户角色权限而定）。**

-   **归属：每个用户组都严格归属于一个组织。**

```{=html}
<!-- -->
```
-   ### **用户（User）：**

```{=html}
<!-- -->
```
-   **唯一归属：每个用户
    严格归属于且只能归属于一个用户组。创建用户时必须指定所属用户组（后续可进行移动操作）。**

-   **角色与权限：每个用户拥有一个或多个角色。角色包含具体的权限，用户的最终权限为所有角色权限的并集（RBAC）。角色决定了用户可以访问哪些模块、执行哪些操作。**

```{=html}
<!-- -->
```
-   ### **终端组（Terminal Group）：**

```{=html}
<!-- -->
```
-   **独立树形结构：与用户组相互独立，用于组织和管理播放盒终端，终端组可多级嵌套。**

-   **管理边界与继承权限：终端组的层级关系定义了终端的管理边界和继承权限。（和用户组一致，一个的对象为终端，一个的对象为用户）。**

-   **归属：每个终端组都严格归属于一个组织。用户组与终端组关系为一对多（后有详细说明）。**

```{=html}
<!-- -->
```
-   ### **终端（Terminal）：**

```{=html}
<!-- -->
```
-   **唯一归属： 每个终端严格归属于且只能归属于一个终端组。**

```{=html}
<!-- -->
```
-   ### **素材（Content）：**

```{=html}
<!-- -->
```
-   **创建与归属：由用户上传，所属于用户组。上传时，素材默认归属于
    上传用户当前所属的用户组。用户也可以选择将素材上传到自己所在组下的子用户组。**

-   **可见性：素材的可见性与用户组层级关系一致，即上级用户组的用户可以查看其下级用户组的素材。**

-   **移动：素材后期可以移动至组织内的其他用户组。**

-   **日志记录：素材
    仅记录上传者用户ID用于保存上传日志记录，不用于权限判断。**

```{=html}
<!-- -->
```
-   ### **文件夹（Folder）：**

```{=html}
<!-- -->
```
-   **创建与归属：由用户创建，所属于用户组，用于归纳组内素材（无法存放节目）。创建文件夹时，默认归属于
    创建用户当前所属的用户组，也可以选择在子用户组内创建。**

-   **可见性：与素材逻辑一致，可见性与用户组层级关系一致。**

-   **移动：和素材逻辑一致，可移动至组织内的其他用户组。**

-   **日志记录：仅 记录创建者用户ID作为操作日志记录。**

```{=html}
<!-- -->
```
-   ### **公共资源空间（Public Resource Space）：**

```{=html}
<!-- -->
```
-   **特殊结构：组织内唯一，预设的资源组。**

-   **用途：作为组织内公共资源的存放区域。节目、素材、文件夹等资源可以被移动至公共资源空间。**

-   **访问权限：移动至公共资源组的资源，组织内全体成员 均可以访问。**

-   **管理权限：特定角色（如组织管理员或拥有"公共资源管理"权限的用户）可以移动、删除、添加公共资源组中的资源。**

```{=html}
<!-- -->
```
-   ### **共享文件夹（Share Folder）：**

```{=html}
<!-- -->
```
-   **特殊文件夹：一种特殊的文件夹类型。**

-   **共享机制：创建时，用户可以选择多个有管理权限的用户进行共享。被选中分享的用户组内的用户，可以根据自身角色权限对共享文件夹中的资源进行操作。**

-   **转换：普通文件夹可以修改成共享文件夹，并选择其他用户组进行共享。**

```{=html}
<!-- -->
```
-   ### **节目（Program）：**

```{=html}
<!-- -->
```
-   **创建与归属：由用户使用有权限使用的素材创建，归属于用户组。创建节目时，默认归属于
    创建用户当前所属的用户组，也可以选择在某个子用户组内进行创建。**

-   **日志记录：仅记录创建者用户ID作为操作日志，创建者与权限无关。**

    1.  **核心关系**
        ------------

1.  **组织 - 用户组：一个组织包含多个用户组，用户组形成树形结构。**

2.  **用户组 - 用户：一个用户严格归属于一个用户组。**

3.  **组织 - 终端组：一个组织包含多个终端组，终端组形成树形结构。**

4.  **终端组 - 终端：一个终端严格归属于一个终端组。**

5.  **用户组 -
    终端组权限：用户组可以被分配对特定终端组的控制权限。用户通过其所属用户组继承对应的终端组权限。一个用户组可以分配多个终端组权限。**

6.  **用户组 -
    素材/文件夹/节目：素材、文件夹、节目等资源归属于特定的用户组，其可见性受用户组层级关系控制。**

7.  **用户 - 角色：用户拥有角色， 角色定义了用户的操作权限。（RBAC）**

8.  **角色 - 权限：角色包含多种权限，权限粒度为某个特定操作。（RBAC）**

**用户组与终端组绑定策略**
==========================

**现云平台将用户组和终端组视为一体，已无法满足一些用户的需求（有客户提出是否能给一个用户分配多个终端组权限），且在物联网环境下，考虑系统灵活性、可拓展性的同时，将用户组和终端组设计为相互独立的实体，对比二者合为一体，具有显著优势。**

**分配机制**
------------

**一个用户组可以被分配多个终端组，也可以不分配终端组。在创建新的用户组时，就需要选择该用户组绑定的终端组，之后也可以新增、修改、删除用户组上绑定的终端组。**

**权限边界**
------------

-   **用户组之间不继承：用户根据自己所属的用户组，获得所属用户组绑定的终端组的权限，但用户组之间不继承终端组的权限，例如用户组UA组有终端组TA组和TB组的权限，用户组UA组的父级组U组只有终端组TA组的权限，这时用户组U组无法从UA组直接获得终端组TB组的权限。即
    每个用户组所拥有的终端组的权限和用户组的层级关系无关。**

![descript](media/image3.png){width="6.299305555555556in"
height="3.2985017497812774in"}

***用户组 - 终端组示意图***

-   **终端组之间可继承：分配终端组至用户组时，可选择 仅分配选定组 或
    选定组及包含的子组（用户视终端组设置规则和用户组组织架构自行决定）。**

![descript](media/image4.png){width="6.299305555555556in"
height="4.1908059930008745in"}

***分配终端组类型示意图***

**分配终端组至用户组时的权限校验**
----------------------------------

**当用户尝试修改一个用户组上分配的终端组权限时，系统将采取组合校验的模式，以确保操作的合法性和权限的合理性。**

**校验逻辑：**

1.  **操作用户层级校验：执行修改操作的用户（操作用户）所属的用户组必须是
    被修改用户组 的 上级用户组。**

2.  **操作用户对目标终端组的权限校验：操作用户所属的用户组，必须拥有
    被操作（新增、移除）的终端组 的权限。**

    a.  **如果要给自己的下级用户组新增一个绑定的终端组，则自己所属的用户组须有这个终端组的权限。**

    b.  **如果要给自己的下级用户组移除一个绑定的终端组，则自己所属的用户组须有这个终端组的权限。**

3.  **操作用户的角色权限校验：操作用户的角色须有 修改绑定终端组
    的操作权限。**

    1.  **用户组与终端组分离的优势**
        ----------------------------

-   #### **适应不同的组织结构**

-   **用户组
    通常反映企业的组织架构、部门划分、协作关系等，其层级是为了管理人员权限和协助流程。且在物联网环境下，用户的使用目的也可能不同，可能有永久用户（每天管理终端播控的管理员和操作员）和临时用户（根据需要访问系统的系统集成商或服务团队成员）使用该系统。**

-   **终端组
    则更多的反映播放盒的地理位置、功能类型、部署状态等物理或逻辑上的组织方式。**

-   **两者分离时，系统可以独立地适应用户组织结构的变化和播放盒部署结构的变化，二者互不影响。**

> ![descript](media/image5.png){width="5.99375in"
> height="3.9595417760279963in"}
>
> ***终端组 - 用户组分离场景示意图***

-   #### **清晰的职责划分与管理边界**

```{=html}
<!-- -->
```
-   **职责单一化：用户组专注于管理"谁能做什么"，终端组专注于管理"什么播放盒在哪里"。这种职责单一化使得系统设计更加清晰，模块功能更聚焦。**

-   **管理边界明确：用户组的层级关系定义了用户之间的管理权限边界，终端组的层级定义了设备管理的范围。**

```{=html}
<!-- -->
```
-   #### **系统设计层面**

```{=html}
<!-- -->
```
-   **减少耦合，简化变更管理**

-   **提高可读性和可理解性**

**资源所属组权限判断**
======================

**素材、文件夹、节目的可见性和操作权限主要由其所属的用户组决定，并结合用户所属用户组**

**的层级关系进行判断。**

**素材、文件夹、节目可见性**
----------------------------

**可见性仅为用户是否可以看见某个素材，不代表可以对素材进行操作（修改、移动、删除等）**

-   **默认可见性**

**用户可以查看其 所属用户组 及其 所有下级用户组
下的素材、文件夹和节目。**

-   **公共资源空间**

**公共资源空间中的素材、文件夹、节目对 组织内所有用户 可见。**

-   **共享文件夹**

**如果素材位于一个共享文件夹中，则被共享的用户组下的用户也可见该资源。**

**上级组可以看到下级组的共享文件夹内容。**

![descript](media/image6.png){width="6.299305555555556in"
height="4.2974081364829395in"}

***素材可见性示意图***

**素材、文件夹、节目操作权限**
------------------------------

**在满足可见性条件的基础上，用户对素材、文件夹、节目的具体操作还需要满足以下条件：**

-   **用户角色权限**

**用户必须拥有对应操作所需的角色权限。**

-   **公共资源空间管理权限**

**对公共资源空间中的资源，只有拥有特定管理权限的用户或组织管理员才能进行编辑、删除、移动等操作。**

**节目的特殊性**
----------------

**节目的权限优先级高于素材，即如果一个用户可以看见某个节目，且该用户具有修改节目的角色权限，则不管用户是否对该节目内某个素材没有权限，都可以对节目进行修改。**

***例如：组织管理员使用一个上级用户组内的素材M制作了节目A，并将节目A归属于用户U所在的下级用户组UG，即使用户U对节目A内的素材M无权限，用户U还是可以操作该节目A。***

**如果判断节目权限时还要进一步判断节目内的素材权限，将引入更复杂的逻辑，可能造成权限冲突问题，所以系统仅判断节目权限，可以保留详细的操作日志，其他交由客户自己控制。**

**公共与共享机制**
==================

-   **公共资源空间**

**系统提供公共资源空间用于组织级别的资源共享。公共资源空间下的资源对组织内所有用户组默认为可见和可用。相当于全组织共享资源库。用户无需特别授权即可访问公共资源组内的节目和素材，但仍需具备相应功能权限才能移动、删除这些资源。**

-   **共享文件夹**

**除了公共资源空间，还支持通过共享文件夹实现组织内跨用户组的定向资源共享。资源管理者可以将某个文件夹设置为共享文件夹（或直接创建共享文件夹），并授权给一个或多个指定的用户组。被授权的用户组下的用户即可访问该文件夹中的资源。由于上级用户组也可以看到下级用户组的共享文件夹内容，所以选择分享的用户组时不支持选择"是否包含子用户组"。**

**共享文件夹机制使不同用户组之间可以共享特定资源，而无需改变资源的归属关系或打破原有的组权限边界。**

**用户的用户组变动对资源影响**
==============================

**针对于现系统出现的用户移动后出现资源权限冲突问题，本方案采取以下策略：**

-   **资源归属不变：素材、节目、文件夹在创建时即归属于特定的用户组，其归属关系是固定的，不随上传/创建者用户的移动而改变。**

-   **重新计算权限：用户被移动至新的用户组后，系统将根据其新的用户组归属，重新计算其对资源的可见权限。**

    -   **可见性丧失：如果某个资源之前是用户通过在旧用户组的层级关系而可见的，那么用户移动到新用户组后，如果新用户组与该资源所属组不再满足层级关系，用户将不可见该资源。**

    -   **可见性获得：如果某个资源之前不可见，但用户移动到新用户组后，新用户组与该资源所属用户组满足层级关系，用户将获得该资源的可见性。**

-   **创建者ID仅作日志：素材、节目、文件夹的上传/创建者ID仅用于记录日志，不同于权限判断。意味着用户即使是资源的创建者，如果其当前的所属用户组与该资源所属用户组的层级关系不满足可见性条件，也无法看见该资源。即将用户与素材解耦，将素材的所有权归于用户组。**

-   **提醒但不限制：对于一些可能出现由于用户移动而发生的资源权限变更问题，系统可以给出提醒，但不会限制用户的操作。系统只保证整套逻辑闭环即可。**

**终端上播放的节目与用户权限冲突问题**
======================================

-   **场景分析：**

    -   **用户A，低级用户，所属用户组UG\_Low，对终端T有操作权限。**

    -   **节目P由高级用户（所属用户组UG\_High）创建并归属于UG\_High。**

    -   **节目P当前正在终端T上播放。**

-   **处理方案**

**针对这类权限冲突场景，采取"只见概要"策略，如果用户拥有目标终端组的操作权限，但缺少该节目内容的访问权限，那么该用户在调度该节目到终端时只能够看到节目基本信息，但无法预览或编辑节目详细内容，这样既允许用户执行终端播放操作，又确保未经授权的节目内容不被泄露或修改。**

**权限融合模型**
================

**本方案将RBAC与ABAC两种控制机制相结合，以实现精细且安全的权限管理：**

-   **RBAC（基于角色的访问控制）：通过给用户分配角色来授予功能权限。角色定义了用户可执行的操作范围（例如哪些接口、功能模块或管理动作）。只有用户拥有某项操作对应的角色权限，才能执行该操作。这确保了操作层面的控制，即用户只能使用被授权的功能。**

> ![descript](media/image7.png){width="5.760416666666667in"
> height="2.7148632983377077in"}
>
> *RBAC示意图*

-   **ABAC（基于属性的访问控制）：通过用户和资源所具有的属性来限制访问范围。在本系统中采用的属性主要是"用户组与资源所属组的层级关系"。即根据用户所在的用户组相对于资源所属用户组的关系，决定用户是否有权访问该资源。例如，上级用户组的成员通常可以查看管理下级用户组的资源，而下级组的成员无法越级访问上级组的资源。此类基于组属性的规则保证了数据层面的隔离。**

> ![descript](media/image8.png){width="5.760416666666667in"
> height="4.4186843832021in"}
>
> *ABAC示意图*

综合以上两种机制，系统在执行权限校验时要求**同时满足RBAC和ABAC条件**：既要有相应功能的角色权限，又要符合资源归属的组级可见策略。只有当操作权限和数据范围都被授权时，用户才能成功访问并操作目标资源，从而实现安全的精细化权限控制。

**拓展性说明**
==============

为了适应未来需求，当前的权限模型在设计时预留了扩展空间，支持在必要时引入如下功能：

-   **资源归属变更：**允许调整资源所属的用户组。未来可通过受控流程将资源从一个用户组转移到另一个，以满足组织架构调整或资源重新分类的需求，同时确保转移过程中的审批和权限验证。

-   **版本控制：**针对关键资源和权限配置引入版本管理机制。可以记录资源或权限策略的历史版本，实现变更追踪和回滚，增强系统变更的安全性与可审计性。

-   **多组绑定：**拓展用户或资源可以隶属/绑定多个组的能力。例如，未来可支持用户拥有跨多个用户组的临时角色，或资源同时被授权给多个用户组，从而实现更灵活的权限分配策略。

-   **临时授权：**提供临时权限授予功能。在特殊场景下（如临时项目、紧急任务），管理员可以在限定时间窗口内授予某用户额外权限，过期后权限自动收回。临时授权确保特殊需求下的权限开放可控且可审计。

上述扩展特性可以在保持现有架构的基础上平滑融合，体现了权限模型良好的可拓展性。通过预留接口和策略控制点，系统能够根据业务发展灵活调整权限规则，满足未来复杂多变的权限管理需求。
