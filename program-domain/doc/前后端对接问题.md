后端接口规范（网关版）
网关统一入口（开发环境）：http://192.168.1.222:8082
服务前缀
认证服务：/auth/api/
核心业务服务（含节目/素材元数据）：/core/api/
文件服务（上传/预览/下载/文件信息）：/file/api/
消息服务：/message-service/（本阶段不涉及）
认证方式：Cookie（SPA）
一、素材相关（供编辑器素材库使用）
获取素材树（已存在）
GET /core/api/material/tree/init
列出全部素材（用于编辑器统一素材库）
GET /core/api/material/get/all
Query：page? pageSize? keyword? type? category?
Resp.data: ListMaterialResponse[]（至少包含：mid, materialName, fileId, materialType, fileSize, mimeType, fileExtension, fileStatus, processProgress?, description?, uploadTime, updateTime）
用户组素材/公共/分享（已存在）
GET /core/api/material/list/user?ugid&fid&includeSub
GET /core/api/material/list/public?fid&includeSub
GET /core/api/material/list/shared?fid&includeSub
获取素材详情（编辑器拖拽后可能拉取更多信息）
GET /core/api/material/detail/{mid}
Resp.data 需补充：md5Hash, accessUrl, fileId, width?, height?, duration?, format?, supportsPreview?
单文件上传（文件服务）
POST /file/api/file/upload/single（FormData：file, 可选folderId, materialName, description）
Resp.data：{ taskId, fileId?, status }（与文件服务现有文档一致）
预览/下载（文件服务）
GET /file/api/file/preview/{fileId}
GET /file/api/file/download/{fileId}
GET /file/api/file/info/{fileId} -> 返回md5Hash, size, mime, width/height（若图片/视频）, duration（若视频）
错误返回（统一）
约定：{ code: number, msg: string, data?: any }
成功：code=0（或200），data有值
失败：code!=0，msg为错误信息（可能配合ERR_2xxx素材相关错误码）
二、节目管理（核心）
数据说明
Create/Update 请求中关键字段（前端计算/生成）：
name string
description string
width number（字符串化给VSN时会转string）
height number
duration number（毫秒，计算规则：页面时长=各区域时长最大值，区域时长=其Item时长之和；总时长=各页面时长之和）
status string（draft|ready|published）
thumbnailUrl string
vsnData string（字符串化后的严格VSN JSON，数值都为字符串，颜色0xAARRGGBB，LogFont.lfHeight必填，LoopType=0则AppointDuration必填，Region.Rect含X/Y/Width/Height/BorderWidth等）
contentData string（字符串化的前端编辑状态JSON：EditorState，包含Fabric序列化CanvasState）
1) 创建节目
   POST /core/api/program/create
   Req.body CreateProgramRequest：
   Resp.data：{ programId, versionId, status }
2) 更新节目（覆盖最新）
   PUT /core/api/program/{programId}
   Req.body 同 Create（除非只改部分字段，也支持部分）
   Resp.data：{ programId, versionId }
3) 保存草稿（不变更正式版本，保留独立版本号与编辑状态）
   POST /core/api/program/{programId}/draft
   Req.body：{ contentData: string, thumbnailUrl?: string }
   后端落库草稿版本，并返回draftVersionId
   Resp.data：{ programId, draftVersionId, savedAt }
4) 发布节目（从当前准备好的版本发布）
   POST /core/api/program/{programId}/publish
   Req.body：{ publishRemark?: string }
   后端将当前“ready”的版本标记为published并记录版本号
   Resp.data：{ programId, versionId, publishedAt }
5) 获取节目详情（基础元数据）
   GET /core/api/program/{programId}
   Resp.data：{ programId, name, description, width, height, duration, status, thumbnailUrl, latestVersionId, createdAt, updatedAt }
6) 获取节目内容（用于回显）
   GET /core/api/program/{programId}/content
   可选 Query：versionId?（若不传则返回最新版本内容；支持传draftVersionId或历史versionId）
   Resp.data：
7) 节目列表
   GET /core/api/program/list?keyword=&status=&page=&pageSize=&sortBy=&sortOrder=
   Resp.data：{ items: ProgramSummary[], total, page, pageSize }
8) 删除节目
   DELETE /core/api/program/{programId}
   Resp.data：{ programId, deleted: true }
9) 复制节目
   POST /core/api/program/{programId}/copy
   Resp.data：{ programId: "newId" }
10) 版本管理
    GET /core/api/program/{programId}/versions
    Resp.data：{ items: [{versionId, type: "draft|release", status, createdAt, remark?}], total }
    POST /core/api/program/{programId}/versions/{versionId}/revert
    将指定版本内容恢复为“当前编辑版本”（不直接发布）
    Resp.data：{ programId, newVersionId }
    错误返回（统一）
    约定：{ code: number, msg: string, data?: any }
    节目相关错误码建议：
    ERR_3001 PROGRAM_NOT_FOUND
    ERR_3002 PROGRAM_SAVE_FAILED
    ERR_3003 PROGRAM_VSN_INVALID
    ERR_3006 PROGRAM_MATERIAL_MISSING
    校验失败时返回字段级错误详情：
    三、系统/配置（可选）
    字体列表
    GET /core/api/system/fonts
    Resp.data：[{ name, family, supportsBold, supportsItalic }]
    颜色/模板（可选）
    GET /core/api/system/templates
    GET /core/api/system/palette
    四、数据一致性与校验
    设备播放必需字段：由后端二次校验（同时前端在 VSN 生成时已预校验）：
    数字型全部为字符串；颜色均为形如0xAARRGGBB；LogFont.lfHeight必填；
    Page.LoopType=0时强制要求AppointDuration；
    Region.Rect含X/Y/Width/Height/BorderWidth五项；
    Region.name="sync_program" 限定 ItemType ∈ {2,3,6}；
    Text类 Item 需 text 且 logFont.lfHeight 必填。
    素材引用有效性：后端可提供批量验证接口（可选）
    POST /core/api/material/refs/validate，入参：[{ materialId, md5Hash? }]
    五、示例：CreateProgramRequest 与响应
    请求
    响应
