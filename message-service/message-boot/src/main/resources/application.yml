server:
  port: 8084
  
spring:
  application:
    name: message-service
  profiles:
    active: dev
  
  # MongoDB 配置
  data:
    mongodb:
      host: 192.168.1.185
      port: 27017
      database: led-platform-messages
      username: ${MONGODB_USERNAME:admin}
      password: ${MONGODB_PASSWORD:admin123456}
      
  # Redis 配置  
  redis:
    host: 192.168.1.185
    port: 6379
    password: ${REDIS_PASSWORD:}
    database: 2  # 使用数据库2专门存储消息相关数据
    lettuce:
      pool:
        max-active: 20
        max-idle: 8
        min-idle: 0
        
  # RabbitMQ 配置
  rabbitmq:
    host: ${RABBITMQ_HOST:192.168.1.185}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:admin}
    password: ${RABBITMQ_PASSWORD:admin123456}
    virtual-host: ${RABBITMQ_VHOST:/led-platform}
    publisher-confirm-type: correlated
    publisher-returns: true
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          initial-interval: 1000
          max-attempts: 3
          max-interval: 5000
          multiplier: 2.0
          
  # Nacos 服务发现和配置中心
  cloud:
    nacos:
      discovery:
        server-addr: 192.168.1.185:8848
        namespace: 1e90921e-70cf-4745-87ed-dd165319ff3a
        group: DEFAULT_GROUP
        enabled: ${NACOS_DISCOVERY_ENABLED:true}  # 可通过环境变量控制
      config:
        server-addr: 192.168.1.185:8848
        namespace: 1e90921e-70cf-4745-87ed-dd165319ff3a
        group: DEFAULT_GROUP
        file-extension: yml
        enabled: ${NACOS_CONFIG_ENABLED:true}      # 可通过环境变量控制
        import-check:
          enabled: ${NACOS_IMPORT_CHECK_ENABLED:true}  # 可通过环境变量控制
        
# 管理和监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,websocket
  endpoint:
    health:
      show-details: always
  prometheus:
    metrics:
      export:
        enabled: true
# Gateway认证配置
gateway:
  userinfo-endpoint: ${GATEWAY_USERINFO_ENDPOINT:http://localhost:8082/userinfo}
  validation-timeout: ${GATEWAY_VALIDATION_TIMEOUT:5000}

# JWT配置（用于兼容性，如果需要直接JWT验证）
jwt:
  secret: ${JWT_SECRET:defaultSecretKeyForWebSocketTokenValidation}
  expire-tolerance: ${JWT_EXPIRE_TOLERANCE:5}

# WebSocket配置
websocket:
  heartbeat:
    interval: ${WEBSOCKET_HEARTBEAT_INTERVAL:60}  # 心跳检测间隔（秒）
    timeout: ${WEBSOCKET_HEARTBEAT_TIMEOUT:180}   # 心跳超时时间（秒）
  session:
    cleanup-interval: ${WEBSOCKET_SESSION_CLEANUP_INTERVAL:300}  # 会话清理间隔（秒）
    max-idle-time: ${WEBSOCKET_SESSION_MAX_IDLE:1800}           # 最大空闲时间（秒）

# 日志配置
logging:
  level:
    org.nan.cloud.message: DEBUG
    org.springframework.web.socket: DEBUG
    org.springframework.web.client.RestTemplate: DEBUG
    org.springframework.amqp: INFO
    org.springframework.data.mongodb: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%logger{50}] - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%logger{50}] - %msg%n"